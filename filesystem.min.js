function FileSystem(a){var c=this,b=window.requestFileSystem||window.webkitRequestFileSystem;a=a||{};a.type=a.type||window.TEMPORARY;a.size=a.size||104857600;c._debug=a.debug||!1;b(a.type,a.size,function(b){c._fs=b;a.hasOwnProperty("onSuccess")&&"function"===typeof a.onSuccess&&a.onSuccess.call(c,c)},function(b){c._errorHandler(b);a.hasOwnProperty("onFail")&&"function"===typeof a.onFail&&a.onFail.call(c,b)})}
FileSystem.prototype={_fs:null,_debug:!1,_resultHandler:function(a,c){return function(b){(b instanceof FileError||b.constructor===FileError)&&a._errorHandler(b);"function"!==typeof c?a._errorHandler(a._fileError("callback must be a function.")):c.call(a,b)}},_errorHandler:function(a){this._debug&&console.log(a.name+": "+a.message)},_fileError:function(a){a={message:a};a.constructor=FileError;return a}};
FileSystem.prototype.md=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getDirectory(a,{create:!0},b,b)}};FileSystem.prototype.cd=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getDirectory(a,{},b,b)}};FileSystem.prototype.deltree=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getDirectory(a,{},function(a){a.removeRecursively(b,b)},b)}};
FileSystem.prototype.rd=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getDirectory(a,{},function(a){a.remove(b,b)},b)}};FileSystem.prototype.dir=function(a,c){function b(a){a.createReader().readEntries(f,f)}if(null!=this._fs){var f=this._resultHandler(this,c);a?this._fs.root.getDirectory(a,{},b,f):b(this._fs.root)}};FileSystem.prototype.create=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getFile(a,{create:!0,exclusive:!0},b,b)}};
FileSystem.prototype.open=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getFile(a,{create:!1},b,b)}};FileSystem.prototype.del=function(a,c){if(null!=this._fs){var b=this._resultHandler(this,c);this._fs.root.getFile(a,{create:!1},function(a){a.remove(b,b)},b)}};
FileSystem.prototype.copy=function(a,c,b){function f(b){function c(a){a.copyTo(b,null,e,e)}d._fs.root.getFile(a,{create:!1},c,function(){d._fs.root.getDirectory(a,{},c,e)})}if(null!=this._fs){var d=this,e=this._resultHandler(this,b);d._fs.root.getDirectory(c,{},f,e)}};
FileSystem.prototype.move=function(a,c,b){function f(b){function c(a){a.moveTo(b,null,e,e)}d._fs.root.getFile(a,{create:!1},c,function(){d._fs.root.getDirectory(a,{},c,e)})}if(null!=this._fs){var d=this,e=this._resultHandler(this,b);d._fs.root.getDirectory(c,{},f,e)}};
FileSystem.prototype.ren=function(a,c,b){function f(a){a.getParent(function(b){a.moveTo(b,c,g,g)})}function d(){e._fs.root.getFile(a,{create:!1},f,g)}if(null!=this._fs){var e=this,g=this._resultHandler(this,b);e._fs.root.getDirectory(a,{},f,d)}};
FileSystem.prototype.read=function(a,c,b){function f(a){var d=new FileReader;d.onloadend=function(a){b(a)};if("function"===typeof d[c.type])d[c.type](a,c.encoding)}if(null!=this._fs){var d=this._resultHandler(this,b);c.type=c.type||"readAsText";c.encoding=c.encoding||"utf8";this._fs.root.getFile(a,{},function(a){a.file(f,d)},d)}};
FileSystem.prototype.write=function(a,c,b){function f(b){b.remove(function(){e._fs.root.getFile(a,{create:!0},d,g)},g)}function d(a){a.createWriter(function(a){a.seek(a.length);a.onwriteend=function(a){b(a)};a.write(c.data)})}if(null!=this._fs){var e=this,g=this._resultHandler(this,b);"object"===typeof c&&c.data instanceof Blob?e._fs.root.getFile(a,{create:!0},c.append?d:f,g):g(e._fileError("param.data must be a blob!"))}};